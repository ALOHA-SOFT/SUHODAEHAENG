<th:block th:fragment="header">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <header class="container">
    <!-- util -->
    <div class="util d-flex justify-content-end align-items-center">
      <!-- ğŸ” ë¡œê·¸ì¸ âŒ -->
      <th:block sec:authorize="isAnonymous()">
        <a href="/join" class="mx-2">íšŒì›ê°€ì…</a>
        <a href="/login" class="mx-2">ë¡œê·¸ì¸</a>
      </th:block>
      <!-- ğŸ” ë¡œê·¸ì¸ â­• -->
      <th:block sec:authorize="isAuthenticated()">
        <th:block sec:authorize="hasRole('ADMIN')">
          <a href="/admin" class="mx-2 text-danger fw-bold">ê´€ë¦¬ì</a>
        </th:block>
        <a href="/my" class="mx-2">ë§ˆì´ í˜ì´ì§€</a>
        <a href="/my/orders" class="mx-2">ì£¼ë¬¸ì¡°íšŒ</a>
      </th:block>
      <a href="/info" class="mx-2">ê³ ê°ì•ˆë‚´</a>
    </div>
    <!-- logo -->
    <div class="logo text-center">
      <a href="/" class="text-decoration-none">
        <img src="/img/logo.png" alt="logo" style="max-height: 68px;" class="animate__animated animate__fadeInUp animate__delay-1s">
        <!-- <h5 id="typing" class="m-0 fw-bold animate__animated animate__fadeInUp animate__delay-2s">ìˆ˜ê²½ì‹œì„¤ ì „ë¬¸ì—…ì²´</h5> -->
        <script src="https://unpkg.com/typeit@8.8.5/dist/index.umd.js"></script>
        <h5 id="typing" style="font-size: 22px;" class="m-0"></h5>
        <script>
          new TypeIt("#typing", {
            strings: "ìˆ˜ê²½ì‹œì„¤ ì „ë¬¸ì—…ì²´",
            speed: 100,
            startDelay: 2000,
            loop: false,
            cursor: false,
          }).go();
        </script>
      </a>
    </div>

    <!-- 
      ë°˜ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜ 
      - í–„ë²„ê±° ë©”ë‰´
      - ë©”ë‰´
        -  ìƒí’ˆ
        - ë¶„ìˆ˜
        - ìˆ˜ì˜ì¥
        - ë¯¸ìŠ¤íŠ¸/ìŠ¤í”„ë§ì¿¨ëŸ¬
        - ê¸°íƒ€
      - ì‚¬ìš©ì ì•„ì´ì½˜
      - ì¥ë°”êµ¬ë‹ˆ ì•„ì´ì½˜
    -->
    <nav class="navbar navbar-expand-lg navbar-light p-0">
      <div class="container-fluid d-flex justify-content-between align-items-center">
        <div class="d-flex justify-content-between align-items-center">
          
          <button class="me-4 d-flex justify-content-center align-items-center" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="material-icons md-48">menu</span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/products">ì „ì²´ ìƒí’ˆ</a>
              </li>
            </ul>
            <!-- ì¹´í…Œê³ ë¦¬ ë™ì  ë¡œë”© ì˜ì—­ -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="category-skeleton">
              <li class="nav-item"><span class="nav-link disabled"><span class="placeholder-glow"><span class="placeholder col-6"></span></span></span></li>
              <li class="nav-item"><span class="nav-link disabled"><span class="placeholder-glow"><span class="placeholder col-5"></span></span></span></li>
              <li class="nav-item"><span class="nav-link disabled"><span class="placeholder-glow"><span class="placeholder col-4"></span></span></span></li>
            </ul>
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="category-nav">

            </ul>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-center gap-3">
          <!-- person -->
          <!-- ğŸ” ë¡œê·¸ì¸ â­• -->
          <th:block sec:authorize="isAuthenticated()">
            <a href="/my" class="text-decoration-none">
              <span class="material-icons md-48">person</span>
            </a>
            <a href="/my/carts" class="text-decoration-none">
              <span class="material-icons md-48">shopping_cart</span>
            </a>
          </th:block>
          <!-- ğŸ” ë¡œê·¸ì¸ âŒ -->
          <th:block sec:authorize="!isAuthenticated()">
            <a href="/login" class="text-decoration-none">
              <span class="material-icons md-48">login</span>
            </a>
            <a href="/carts" class="text-decoration-none">
              <span class="material-icons md-48">shopping_cart</span>
            </a>
          </th:block>
        </div>
      </div>
    </nav>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
          <a href="/">
            <img src="/img/logo.png" alt="logo" class="offcanvas-logo" style="max-height: 100px;">
          </a>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <nav>
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 text-center">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/products">ì „ì²´ ìƒí’ˆ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/products?category=water-fountain">ë¶„ìˆ˜</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/products?category=swimming-pool">ìˆ˜ì˜ì¥</a>
              </li>
              <!-- <li class="nav-item">
                <a class="nav-link" href="/products?category=mister-sprinkler">ë¯¸ìŠ¤íŠ¸/ìŠ¤í”„ë§ì¿¨ëŸ¬</a>
              </li> -->
              <!-- <li class="nav-item">
                <a class="nav-link" href="/products?category=etc">ê¸°íƒ€</a>
              </li> -->
              <hr>
              
              <li class="nav-item my-2">
                <div class="row">
                  <!-- ğŸ” ë¡œê·¸ì¸ â­• -->
                  <th:block sec:authorize="isAuthenticated()">
                    <div class="col">
                      <a href="/my" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">person</span>
                        <span>ë§ˆì´</span>
                      </a>
                    </div>
                    <div class="col">
                      <a href="/my/carts" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">shopping_cart</span>
                        <span>ì¥ë°”êµ¬ë‹ˆ</span>
                      </a>
                    </div>
                  </th:block>
                  <!-- ğŸ” ë¡œê·¸ì¸ âŒ -->
                  <th:block sec:authorize="isAnonymous()">
                    <div class="col">
                      <a href="/join" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">person_add</span>
                        <span>íšŒì›ê°€ì…</span>
                      </a>
                    </div>
                    <div class="col">
                      <a href="/login" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">login</span>
                        <span>ë¡œê·¸ì¸</span>
                      </a>
                    </div>
                  </th:block>
                </div>
              </li>
              <li class="nav-item my-2">
                <div class="row">
                  <div class="col">
                    <!-- ğŸ” ë¡œê·¸ì¸ âŒ -->
                    <th:block sec:authorize="isAnonymous()">
                      <a href="/orders" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">receipt_long</span>
                        <span>ì£¼ë¬¸ì¡°íšŒ</span>
                      </a>
                    </th:block> 
                    <!-- ğŸ” ë¡œê·¸ì¸ â­• -->
                    <th:block sec:authorize="isAuthenticated()">
                      <a href="/my/orders" class="card p-3 d-flex justify-content-center align-items-center shadow">
                        <span class="material-icons">receipt_long</span>
                        <span>ì£¼ë¬¸ì¡°íšŒ</span>
                      </a>
                    </th:block>
                  </div>
                  <div class="col">
                    <a href="/info" class="card p-3 d-flex justify-content-center align-items-center shadow">
                      <span class="material-icons">info</span>
                      <span>ê³ ê°ì•ˆë‚´</span>
                    </a>
                  </div>
                </div>
              </li>
              <hr>
              <!-- ğŸ” ë¡œê·¸ì¸ â­• -->
              <th:block sec:authorize="isAuthenticated()">
                <li class="nav-item">
                  <form action="/logout" method="post">
                    <!-- ğŸ’ CSRF TOKEN -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <div class="row">
                      <div class="col">
                          <button type="submit" class="card p-3 d-flex justify-content-center align-items-center shadow w-100">
                            <span class="material-icons">logout</span>
                            <span>ë¡œê·¸ì•„ì›ƒ</span>
                          </button>
                        </div>
                      </div>
                  </form>
                </li>
              </th:block>
            </ul>
          </nav>
        </div>
      </div>
      
      <hr>
  </header>


  <style>
    .util {
      height: 40px;
      font-size: 14px;
    }

    nav a { font-weight: bold !important; }
    nav a:hover { color: var(--main-color) !important; }

    .placeholder-glow .placeholder {
      display: inline-block;
      height: 1.5em;
      background: #e0e0e0;
      border-radius: 0.3em;
      animation: placeholder-glow 1.2s infinite linear;
    }
    @keyframes placeholder-glow {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }
  </style>

  <script>
    // ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ ë™ì  ë¡œë”©
    function renderCategoryNav(categories) {
      const nav = document.getElementById('category-nav');
      nav.innerHTML = '';
      categories.forEach(cat => {
        const li = document.createElement('li');
        li.className = 'nav-item';
        const a = document.createElement('a');
        a.className = 'nav-link';
        a.href = `/products/category/${encodeURIComponent(cat.no)}`;
        a.textContent = cat.name;
        li.appendChild(a);
        nav.appendChild(li);
      });
    }
    function showCategoryError() {
      const nav = document.getElementById('category-nav');
      nav.innerHTML = '';
    }
    document.addEventListener('DOMContentLoaded', function() {
      fetch('/api/category?size=10')
        // .then(res => res.ok ? res.json() : Promise.reject())
        .then(res => res.json() )
        .then(data => {
          document.getElementById('category-skeleton').style.display = 'none';
          if (Array.isArray(data.list)) {
            renderCategoryNav(data.list);
          } else if (Array.isArray(data)) {
            renderCategoryNav(data);
          } else {
            showCategoryError();
          }
          
        })
        .catch(showCategoryError);
    });
  </script>
</th:block>


