<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{UI/layouts/admin/admin_layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„¤ë¬¸ ìˆ˜ì • - ìˆ˜í˜¸ëŒ€í–‰</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css">
  <style>
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f8f9fa;
    }
    
    .page-title {
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background-color: #007bff;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #0056b3;
    }
    
    .btn-success {
      background-color: #28a745;
      color: white;
    }
    
    .btn-success:hover {
      background-color: #218838;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
    }
    
    .form-container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .form-section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #007bff;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-row.full-width {
      grid-template-columns: 1fr;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-label {
      font-size: 14px;
      font-weight: 600;
      color: #555;
    }
    
    .form-label.required::after {
      content: ' *';
      color: #dc3545;
    }
    
    .form-control {
      padding: 10px 15px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #007bff;
    }
    
    .form-control:disabled {
      background-color: #f8f9fa;
      cursor: not-allowed;
    }
    
    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #f8f9fa;
    }
    
    .service-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .service-option {
      display: flex;
      align-items: center;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .service-option:hover {
      border-color: #007bff;
      background-color: #f8f9fa;
    }
    
    .service-option input[type="checkbox"],
    .service-option input[type="radio"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .service-option.checked {
      border-color: #007bff;
      background-color: #e7f3ff;
    }
    
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert-info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .form-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body layout:fragment="content">
  <div class="container-fluid">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
      <h2 class="page-title">ğŸ“ ì„¤ë¬¸ ìˆ˜ì •</h2>
      <div class="header-actions">
        <a href="/admin/forms" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
        </a>
      </div>
    </div>

    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i> ì„¤ë¬¸ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ í•˜ë‹¨ì˜ "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
    </div>

    <form id="updateForm" class="form-container" th:object="${forms}">
      <input type="hidden" id="formId" th:value="*{id}">
      <input type="hidden" id="formNo" th:value="*{no}">
      
      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="form-section">
        <h3 class="section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label required">ì‹ ì²­ì¸ëª…</label>
            <input type="text" class="form-control" id="name" th:value="*{name}" required>
          </div>
          <div class="form-group">
            <label class="form-label required">ì—°ë½ì²˜</label>
            <input type="tel" class="form-control" id="tel" th:value="*{tel}" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label required">ìƒíƒœ</label>
            <select class="form-control" id="status" th:value="*{status}" required>
              <option value="ì ‘ìˆ˜" th:selected="*{status == 'ì ‘ìˆ˜'}">ì ‘ìˆ˜</option>
              <option value="ê²€í† ì¤‘" th:selected="*{status == 'ê²€í† ì¤‘'}">ê²€í† ì¤‘</option>
              <option value="ìŠ¹ì¸" th:selected="*{status == 'ìŠ¹ì¸'}">ìŠ¹ì¸</option>
              <option value="ë°˜ë ¤" th:selected="*{status == 'ë°˜ë ¤'}">ë°˜ë ¤</option>
              <option value="ì™„ë£Œ" th:selected="*{status == 'ì™„ë£Œ'}">ì™„ë£Œ</option>
            </select>
          </div>
        </div>
        
        <div class="form-row full-width">
          <div class="form-group">
            <label class="form-label required">ì£¼ì†Œ</label>
            <input type="text" class="form-control" id="address" th:value="*{address}" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label required">ìƒì„¸ì£¼ì†Œ</label>
            <input type="text" class="form-control" id="detailAddress" th:value="*{detailAddress}" required>
          </div>
        </div>
      </div>

      <!-- ê³µì‚¬ ê¸°ê°„ -->
      <div class="form-section">
        <h3 class="section-title">ğŸ“… ê³µì‚¬ ê¸°ê°„</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label required">ê³µì‚¬ ì‹œì‘ì¼</label>
            <input type="date" class="form-control" id="stdDate" 
                   th:value="${#dates.format(forms.stdDate, 'yyyy-MM-dd')}" required>
          </div>
          <div class="form-group">
            <label class="form-label required">ê³µì‚¬ ì¢…ë£Œì¼</label>
            <input type="date" class="form-control" id="endDate" 
                   th:value="${#dates.format(forms.endDate, 'yyyy-MM-dd')}" required>
          </div>
        </div>
        
        <div class="form-row full-width">
          <div class="form-group">
            <label class="form-label">ì†ŒìŒ ë°œìƒì¼ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
            <input type="text" class="form-control" id="noiseDate" 
                   th:value="*{noiseDate}" 
                   placeholder="ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” (í´ë¦­í•˜ì—¬ ì—¬ëŸ¬ ë‚ ì§œ ì„ íƒ)">
          </div>
        </div>
      </div>

      <!-- ì—…ì²´ ì •ë³´ -->
      <div class="form-section" th:if="*{bizName != null and bizName != ''}">
        <h3 class="section-title">ğŸ¢ ì—…ì²´ ì •ë³´</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ì—…ì²´ëª…</label>
            <input type="text" class="form-control" id="bizName" th:value="*{bizName}">
          </div>
          <div class="form-group">
            <label class="form-label">ëŒ€í‘œìëª…</label>
            <input type="text" class="form-control" id="managerName" th:value="*{managerName}">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ì—…ì²´ ì—°ë½ì²˜</label>
            <input type="tel" class="form-control" id="managerTel" th:value="*{managerTel}">
          </div>
        </div>
      </div>

      <!-- ì…ì£¼ì ì •ë³´ -->
      <div class="form-section" th:if="*{residentName != null and residentName != ''}">
        <h3 class="section-title">ğŸ  ì…ì£¼ì ì •ë³´</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ì…ì£¼ìëª…</label>
            <input type="text" class="form-control" id="residentName" th:value="*{residentName}">
          </div>
          <div class="form-group">
            <label class="form-label">ì…ì£¼ì ì—°ë½ì²˜</label>
            <input type="tel" class="form-control" id="residentTel" th:value="*{residentTel}">
          </div>
        </div>
      </div>

      <!-- ë™ì˜ì„œ ì¡°ê±´ -->
      <div class="form-section" th:if="*{agreementTerms != null and agreementTerms != ''}">
        <h3 class="section-title">ğŸ“œ ë™ì˜ì„œ ì¡°ê±´</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ê´€ë¦¬ì‚¬ë¬´ì†Œ ì¡°ê±´ í™•ì¸ ì—¬ë¶€</label>
            <select class="form-control" id="agreementConditionCheck" th:value="*{agreementConditionCheck}">
              <option value="Y" th:selected="*{agreementConditionCheck == 'Y'}">í™•ì¸ì™„ë£Œ</option>
              <option value="N" th:selected="*{agreementConditionCheck == 'N' or agreementConditionCheck == null}">ë¯¸í™•ì¸</option>
            </select>
          </div>
        </div>
        
        <div class="form-row full-width">
          <div class="form-group">
            <label class="form-label">ë™ì˜ì„œ ì¡°ê±´</label>
            <textarea class="form-control" id="agreementTerms" th:text="*{agreementTerms}"></textarea>
          </div>
        </div>
      </div>

      <!-- ìŠ¹ê°•ê¸° ë³´ì–‘ ì •ë³´ -->
      <div class="form-section" th:if="*{elevatorProtection != null and elevatorProtection != ''}">
        <h3 class="section-title">ğŸ› ï¸ ìŠ¹ê°•ê¸° ë³´ì–‘ ì •ë³´</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ìŠ¹ê°•ê¸° ì™¸ë¶€ ë³´ì–‘ì—¬ë¶€</label>
            <select class="form-control" id="elevatorProtection" th:value="*{elevatorProtection}">
              <option value="Y" th:selected="*{elevatorProtection == 'Y'}">ì˜ˆ</option>
              <option value="N" th:selected="*{elevatorProtection == 'N' or elevatorProtection == null}">ì•„ë‹ˆì˜¤</option>
              <option value="A" th:selected="*{elevatorProtection == 'A'}">ê´€ë¦¬ì‚¬ë¬´ì†Œ ì¡°ê±´ëŒ€ë¡œ ì§„í–‰í•´ì£¼ì„¸ìš”</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ì‹œê³µ ì¸µìˆ˜</label>
            <input type="text" class="form-control" id="elevatorFloors" th:value="*{elevatorFloors}">
          </div>
        </div>
      </div>

      <!-- ê³µì‚¬ ë‚´ìš© -->
      <div class="form-section">
        <h3 class="section-title">ğŸ“ ê³µì‚¬ ë‚´ìš©</h3>
        
        <div class="form-row full-width">
          <div class="form-group">
            <label class="form-label">ê³µì‚¬ ë‚´ìš©</label>
            <textarea class="form-control" id="content" th:text="*{content}"></textarea>
          </div>
        </div>
        
        <div class="form-row full-width">
          <div class="form-group">
            <label class="form-label">ìš”ì²­ì‚¬í•­</label>
            <textarea class="form-control" id="request" th:text="*{request}"></textarea>
          </div>
        </div>
      </div>

      <!-- ì €ì¥ ë²„íŠ¼ -->
      <div class="form-actions">
        <a href="/admin/forms" class="btn btn-secondary">
          <i class="fas fa-times"></i> ì·¨ì†Œ
        </a>
        <button type="submit" class="btn btn-success">
          <i class="fas fa-save"></i> ì €ì¥
        </button>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.js"></script>
  <script th:src="@{/js/common/ajax.js}"></script>
  <script>
    // Flatpickr ì´ˆê¸°í™” (ì†ŒìŒ ë°œìƒì¼ ë‹¤ì¤‘ ì„ íƒ)
    flatpickr("#noiseDate", {
      mode: "multiple",
      dateFormat: "Y-m-d",
      locale: "ko",
      conjunction: ", ",
      plugins: [
        new confirmDatePlugin({
          confirmText: "í™•ì¸",
          showAlways: false,
          theme: "light"
        })
      ]
    });

    // í¼ ì œì¶œ ì²˜ë¦¬
    document.getElementById('updateForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const confirmResult = await $confirm(
        'ğŸ“ ì„¤ë¬¸ ìˆ˜ì •',
        'ì„¤ë¬¸ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
        'question',
        'ìˆ˜ì •',
        'ì·¨ì†Œ'
      );

      if (!confirmResult.isConfirmed) {
        return;
      }
      
      // í¼ ë°ì´í„° ìˆ˜ì§‘
      const formData = {
        id: document.getElementById('formId').value,
        no: document.getElementById('formNo').value,
        name: document.getElementById('name').value,
        tel: document.getElementById('tel').value,
        status: document.getElementById('status').value,
        address: document.getElementById('address').value,
        detailAddress: document.getElementById('detailAddress').value,
        stdDate: document.getElementById('stdDate').value,
        endDate: document.getElementById('endDate').value,
        noiseDate: document.getElementById('noiseDate').value,
        bizName: document.getElementById('bizName')?.value || '',
        managerName: document.getElementById('managerName')?.value || '',
        managerTel: document.getElementById('managerTel')?.value || '',
        residentName: document.getElementById('residentName')?.value || '',
        residentTel: document.getElementById('residentTel')?.value || '',
        agreementTerms: document.getElementById('agreementTerms')?.value || '',
        agreementConditionCheck: document.getElementById('agreementConditionCheck')?.value || 'N',
        elevatorProtection: document.getElementById('elevatorProtection')?.value || 'N',
        elevatorFloors: document.getElementById('elevatorFloors')?.value || '',
        content: document.getElementById('content').value,
        request: document.getElementById('request').value
      };
      
      // ajax.js ê³µí†µ í•¨ìˆ˜ ì‚¬ìš©
      const result = await formsAjax('', 'PUT', formData);
      
      if (result !== 'FAIL' && result.success) {
        $alert('ğŸ“ ìˆ˜ì • ì™„ë£Œ', result.message || 'ì„¤ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        // window.location.href = '/admin/forms';
      } else {
        $alert('ğŸ“ ìˆ˜ì • ì‹¤íŒ¨', result.message || 'ì„¤ë¬¸ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
      }
    });
  </script>
</body>
</html>
