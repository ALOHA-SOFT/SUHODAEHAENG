<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{UI/layouts/admin/admin_layout}">
<head>
  <title>ë¬¸ì˜ì‚¬í•­ ë‹µë³€ - ê´€ë¦¬ì</title>
</head>
<body>
  <main layout:fragment="content">
    <div class="container-fluid">
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/admin">ê´€ë¦¬ì</a></li>
          <li class="breadcrumb-item"><a href="/admin/inquiries">ë¬¸ì˜ì‚¬í•­</a></li>
          <li class="breadcrumb-item active" aria-current="page">ë‹µë³€í•˜ê¸°</li>
        </ol>
      </nav>

      <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
          <!-- Inquiry Preview -->
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5>ì›ë³¸ ë¬¸ì˜</h5>
            </div>
            <div class="card-body">
              <h6 th:text="${inquiry.title}" class="mb-2">ë¬¸ì˜ ì œëª©</h6>
              <div class="text-muted small mb-3">
                <span th:text="${inquiry.name}">ì´ë¦„</span> Â· 
                <span th:text="${#dates.format(inquiry.createdAt, 'yyyy-MM-dd HH:mm')}">2026-01-25 14:30</span>
              </div>
              <div th:text="${inquiry.content}" style="white-space: pre-line; color: #555;">
                ë¬¸ì˜ ë‚´ìš©
              </div>
            </div>
          </div>

          <!-- Reply Form -->
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">ë‹µë³€ ì‘ì„±</h5>
            </div>
            <div class="card-body">
              <form method="post" th:action="@{/api/inquiries/reply}" id="replyForm">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <input type="hidden" name="id" th:value="${inquiry.id}">
                
                <div class="mb-3">
                  <label class="form-label">ë‹µë³€ ë‚´ìš© <span class="text-danger">*</span></label>
                  <textarea class="form-control" name="replyContent" rows="8" 
                            placeholder="ë‹µë³€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                  <small class="text-muted">ê³ ê°ì—ê²Œ ì „ë‹¬ë  ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.</small>
                </div>

                <div class="d-flex gap-2 justify-content-end">
                  <a th:href="@{/admin/inquiries/{id}(id=${inquiry.id})}" class="btn btn-secondary">ì·¨ì†Œ</a>
                  <button type="submit" class="btn btn-primary">ë‹µë³€ ì „ì†¡</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Customer Info -->
          <div class="card mb-4">
            <div class="card-header">
              <h5>ë¬¸ì˜ì ì •ë³´</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label text-muted small">ì´ë¦„</label>
                <p th:text="${inquiry.name}">ì´ë¦„</p>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted small">ì´ë©”ì¼</label>
                <p>
                  <a th:href="@{'mailto:' + ${inquiry.email}}" class="text-decoration-none">
                    <span th:text="${inquiry.email}">email@example.com</span>
                  </a>
                </p>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted small">ì—°ë½ì²˜</label>
                <p>
                  <a th:href="@{'tel:' + ${inquiry.phone}}" class="text-decoration-none">
                    <span th:text="${inquiry.phone}">010-0000-0000</span>
                  </a>
                </p>
              </div>
              <div class="mb-0">
                <label class="form-label text-muted small">ë¬¸ì˜ ì œëª©</label>
                <p th:text="${inquiry.title}">ì œëª©</p>
              </div>
            </div>
          </div>

          <!-- Help Text -->
          <div class="alert alert-info">
            <strong>ğŸ“ íŒ:</strong><br>
            <small>ë‹µë³€ì„ ì‘ì„±í•œ í›„ "ë‹µë³€ ì „ì†¡" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê³ ê°ì—ê²Œ ì´ë©”ì¼ë¡œ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</small>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.getElementById('replyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        showLoading('ë‹µë³€ì„ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
        
        const result = await $ajax({
          url: `/api/inquiries/reply`,
          type: 'POST',
          data: formData
        });
        
        hideLoading();
        
        if (result !== 'FAIL' && result.success) {
          await $alert('ğŸ“§ ë‹µë³€ ì „ì†¡ ì™„ë£Œ', 'ë‹µë³€ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          window.location.href = '/admin/inquiries';
        } else {
          $alert('âŒ ì „ì†¡ ì‹¤íŒ¨', result.message || 'ë‹µë³€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        }
      });
    </script>
  </main>
</body>
</html>
