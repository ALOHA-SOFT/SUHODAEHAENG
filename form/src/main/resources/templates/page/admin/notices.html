<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{UI/layouts/admin/admin_layout}">
<head>
  <title>ê³µì§€ì‚¬í•­ ê´€ë¦¬ - ê´€ë¦¬ì</title>
  <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
  <main layout:fragment="content">
    <div class="container-fluid">
      <!-- Header -->
      <div class="page-header d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>ê³µì§€ì‚¬í•­ ê´€ë¦¬</h1>
          <p class="text-muted">ê³µì§€ì‚¬í•­ ëª©ë¡ ë° ê´€ë¦¬</p>
        </div>
        <a href="/admin/notices/create" class="btn btn-primary">
          <i class="fas fa-plus"></i> ë“±ë¡í•˜ê¸°
        </a>
      </div>

      <!-- Filter Section -->
      <div class="card mb-4">
        <div class="card-body">
          <form method="get" action="/admin/notices" class="row g-3">

            <div class="col-md-3">
              <label class="form-label">ìƒíƒœ</label>
              <select class="form-control" name="status">
                <option value="ì „ì²´" th:selected="${currentStatus == 'ì „ì²´'}">ì „ì²´</option>
                <option value="ê³µê°œ" th:selected="${currentStatus == 'ê³µê°œ'}">ê³µê°œ</option>
                <option value="ë¹„ê³µê°œ" th:selected="${currentStatus == 'ë¹„ê³µê°œ'}">ë¹„ê³µê°œ</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">ê²€ìƒ‰</label>
              <input type="text" class="form-control" name="search" placeholder="ì œëª© ë˜ëŠ” ë‚´ìš© ê²€ìƒ‰" th:value="${param.search}">
            </div>
            
            <div class="col-md-3 d-flex align-items-end">
              <button type="submit" class="btn btn-lg btn-success w-100">
                <i class="bi bi-search"></i> ê²€ìƒ‰
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Table -->
      <div class="card">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th style="">ë²ˆí˜¸</th>
              <th style="width: 40%">ì œëª©</th>
              <th style="">ì‘ì„±ì</th>
              <th style="">ì‘ì„±ì¼</th>
              <th style="">ìƒíƒœ</th>
              <th style="">ì‘ì—…</th>
            </tr>
          </thead>
          <tbody>
            <tr th:if="${pageInfo.list.isEmpty()}">
              <td colspan="6" class="text-center text-muted py-4">ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>
            <tr th:each="notice, stat : ${pageInfo.list}">
              <td th:text="${pageInfo.total - (pageInfo.pageNum - 1) * pageInfo.pageSize - stat.count + 1}">1</td>
              <td>
                <a th:href="@{/admin/notices/{id}(id=${notice.id})}" class="text-decoration-none">
                  <span th:text="${notice.title}">ì œëª©</span>
                </a>
              </td>
              <td th:text="${notice.author}">ì‘ì„±ì</td>
              <td th:text="${#dates.format(notice.createdAt, 'yyyy-MM-dd HH:mm')}">2026-01-25</td>
              <td>
                <span th:if="${notice.status == 'ê³µê°œ'}" class="badge bg-success">ê³µê°œ</span>
                <span th:if="${notice.status == 'ë¹„ê³µê°œ'}" class="badge bg-warning">ë¹„ê³µê°œ</span>
              </td>
              <td>
                <div class="actions">
                  <a th:href="@{/admin/notices/{id}(id=${notice.id})}" class="action-btn view">ìƒì„¸</a>
                  <a th:href="@{/admin/notices/update/{id}(id=${notice.id})}" class="action-btn edit">ìˆ˜ì •</a>
                  <button class="action-btn delete" th:data-id="${notice.id}" onclick="deleteNotice(this)">ì‚­ì œ</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- í˜ì´ì§€ -->
      <th:block th:replace="~{UI/fragments/common/page::page}"></th:block>
    </div>

    <script>
      async function deleteNotice(btn) {
        const noticeId = btn.getAttribute('data-id');
        
        const confirmResult = await $confirm(
          'ğŸ—‘ï¸ ê³µì§€ì‚¬í•­ ì‚­ì œ',
          'ì •ë§ë¡œ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê³µì§€ì‚¬í•­ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
          'warning',
          'ì‚­ì œ',
          'ì·¨ì†Œ'
        );
        
        if (confirmResult.isConfirmed) {
          showLoading('ì‚­ì œ ì¤‘ì…ë‹ˆë‹¤...');
          
          const result = await $ajax({
            url: `/api/notices/${noticeId}`,
            type: 'DELETE'
          });
          
          hideLoading();
          
          if (result !== 'FAIL' && result.success) {
            await $toast({
              title: 'âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤',
              icon: 'success',
              timer: 2000
            });
            location.reload();
          } else {
            $alert('âŒ ì‚­ì œ ì‹¤íŒ¨', result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
          }
        }
      }
    </script>
  </main>
</body>
</html>
